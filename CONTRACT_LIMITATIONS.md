# Contract Limitations

This document outlines the limitations encountered when implementing the contract layer and the modifications made to the autogenerated files to support the application's requirements, specifically regarding authentication and authorization.

## Authentication and Authorization

The original contract definitions generated monolithic route functions (e.g., `authRoutes`) that included both public (login, signup) and protected (logout, change-password) endpoints. This structure made it impossible to apply Ktor's `authenticate` middleware selectively.

### Modifications

To resolve this, the autogenerated server files (e.g., `auth_server.autogen.kt`) were modified:

1.  **Route Splitting**: The single route function was split into `public...Routes` and `protected...Routes`.
2.  **Service Interface Updates**: The Service interfaces were updated to include `userId` (Int) or `token` (String) as parameters for methods that require the authenticated user's context. This data is extracted from the `call.principal` or request headers in the route definition and passed to the service.

### Specific Feature Limitations

#### Auth
- `Logout`: Requires `token` to disable the specific device. Added `token` parameter.
- `ChangePassword`, `Status`, `MustChangePassword`, `DeleteAccount`: Require `userId` to identify the user. Added `userId` parameter.

#### Profile
- `GetProfile`: May require `userId` if fetching own profile.
- `UpdateProfile`: Requires `userId`.

#### Notifications
- `RegisterDevice`, `UnregisterDevice`: Require `userId` and/or `token`.

#### Collections & Questions
- Creating/Editing/Deleting items requires `userId` for ownership checks.

## Missing Features

The following features were present in the contract but not in the existing domain, or vice versa:

- **Communities**: Not implemented in domain. Mocked.
- **Marks**: Not implemented in domain. Mocked.
- **Devices**: Existing `features/devices` mapped to `contracts/features/notifications`.
